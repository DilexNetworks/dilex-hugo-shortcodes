/* =============================================================
   CLEAN REWRITE â€” photo.css
   Behavior:
   - overlay=false: button below; click -> dark bar below (text left of icon)
   - overlay=true : button on image; click -> blurred bar on image bottom (text left of icon)
   ============================================================= */

/* Base wrapper and image */
.photo { --photo-w:auto; --photo-h:auto; max-width:var(--photo-w); position:relative; display:block; }
.photo__media-wrap {
  position: relative;
  display: block;          /* block removes baseline/inline gaps with the bar below */
  line-height: 0;          /* kill any font-line gap inside */
  overflow: hidden;        /* clip on-image bar to the photo edge */
}
.photo__img { width:100%; height:auto; display:block; max-height:var(--photo-h); object-fit:contain; }

/* Reset any global/prose styles that might add margins/borders/shadows to images */
.photo .photo__img {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  box-shadow: none !important;
  background: transparent !important;
  vertical-align: top; /* avoid baseline gaps if rendered inline by a theme */
}

/* ---------------------
   overlay = false (below)
   --------------------- */
.photo:not(.photo--overlay) .photo__bar {
    display:flex; justify-content:flex-end; align-items:center; gap:0.5rem; margin-top:0.3rem;
}

/* The info bar itself (hidden by default; JS toggles classes) */
/* The info bar itself (hidden text by default; JS toggles classes on text span) */
.photo:not(.photo--overlay) .photo__meta {
  display:flex; align-items:center; justify-content:flex-end; gap:0.5rem;
  margin-top:0; padding:0.25rem 0.4rem; /* compact when collapsed */
  background: transparent; color: inherit;
  font-size:0.8rem; line-height:1.3; border-radius:0.4rem;
}
/* Hide only the meta text when collapsed */
.photo:not(.photo--overlay) .photo__meta .photo__meta-text.is-hidden { display:none; }
/* When expanded, apply background/padding */
.photo:not(.photo--overlay) .photo__meta.is-visible { padding:0.5rem 0.75rem; background:#0b0b0c; color:#fff; }
/* make the text hug left, the icon on the right */
.photo:not(.photo--overlay) .photo__meta .photo__meta-text { margin-right:auto; white-space:pre-wrap; }

/* ---------------------
   overlay = true (on image)
   --------------------- */
.photo.photo--overlay .photo__overlay {
    position: absolute !important;
    inset: auto 0.5rem 0.5rem auto;  /* top auto, right .5, bottom .5, left auto */
    z-index: 6;
    pointer-events: none;
}
.photo.photo--overlay .photo__overlay .photo__info-btn { pointer-events:auto; }

/* The on-image info bar (hidden by default; JS toggles classes) */
.photo.photo--overlay .photo__overlaybar {
    position: absolute !important;
    left: 0; right: 0; bottom: 0; top: auto;
    margin: 0; padding-bottom: 0;
    box-sizing: border-box;
    display: none !important;
    align-items: center;
    justify-content: flex-end;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    font-size: 0.8rem;
    line-height: 1.3;
    color: #fff;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    z-index: 4;
    padding-right: 2rem;     /* keep text left of the floating icon */
}
.photo.photo--overlay .photo__overlaybar.is-visible { display: flex !important; }
.photo.photo--overlay .photo__overlaybar .photo__meta-text { margin-right:auto; white-space:pre-wrap; }

/* ---------------------
   buttons
   --------------------- */
.photo__info-btn {
    background:none; border:none; cursor:pointer; color:inherit;
    display:flex; align-items:center; justify-content:center; padding:0.25rem;
}
.photo__info-btn svg { display:block; }

/* Ensure overlay icon is visible on-image and clearly tappable */
.photo.photo--overlay .photo__overlay .photo__info-btn {
  color: #fff;                      /* visible on dark/light images */
  background: rgba(0,0,0,0.35);     /* soft halo for contrast */
  border-radius: .4rem;
  line-height: 0;
  width: 1.75rem; height: 1.75rem;  /* consistent tap target */
  box-shadow: 0 1px 3px rgba(0,0,0,.35);
}
.photo.photo--overlay .photo__overlay .photo__info-btn:hover {
  background: rgba(0,0,0,0.5);
}
.photo.photo--overlay .photo__overlay { z-index: 10; }
.photo.photo--overlay .photo__overlaybar { z-index: 8; }

/* =====================
   Caption layouts
   ===================== */

/* Stacked layout: caption above/below the image */
.photo.photo--stack {
    display: grid;
    grid-template-areas:
    "top"
    "media"
    "bottom";
    grid-auto-rows: auto;
    gap: 0.5rem;
}
.photo.photo--stack .photo__bar--top { grid-area: top; }
.photo.photo--stack .photo__media-wrap { grid-area: media; }
.photo.photo--stack .photo__bar--bottom { grid-area: bottom; }

/* Side layout: caption left or right of the image */
.photo.photo--side {
    display: grid;
    align-items: start;
    gap: 1rem;
}
.photo.photo--side.photo--left {
    grid-template-columns: minmax(12ch, 28ch) 1fr;
    grid-template-areas: "side media";
}
.photo.photo--side.photo--right {
    grid-template-columns: 1fr minmax(12ch, 28ch);
    grid-template-areas: "media side";
}
.photo.photo--side .photo__media-wrap { grid-area: media; }
.photo.photo--side .photo__side { grid-area: side; }

/* Mobile: side captions collapse to stacked (caption below image) */
@media (max-width: 640px) {
  /* Override more-specific left/right rules */
  .photo.photo--side,
  .photo.photo--side.photo--left,
  .photo.photo--side.photo--right {
    grid-template-columns: 1fr;
    grid-template-areas:
      "media"
      "side";
    gap: 0.6rem;
  }

  .photo.photo--side .photo__side {
    align-items: flex-start;
  }
}

/* Caption blocks */
.photo__bar,
.photo__side {
    display: flex;
    align-items: center;
}
.photo__bar { justify-content: space-between; gap: 0.5rem; }
.photo__caption { font-size: 0.95rem; line-height: 1.4; }
/* Slightly softer caption color in dark mode */
:is(.dark *) .photo__caption { color: rgba(203,213,225,1); }

/* Utilities */
.is-hidden { display: none; }
.is-visible { display: block; }

/* Kill any theme margins that could add a full line-height gap */
.photo__media-wrap { margin-bottom: 0 !important; }
.photo__media-wrap + .photo__meta { margin-top: 0 !important; }

/* Final spacing guards to keep the below-image bar flush */
.photo { margin: 0 !important; }
.photo__media-wrap { margin-bottom: 0 !important; padding-bottom: 0 !important; }
.photo__media-wrap + .photo__meta { margin-top: 0 !important; }

/* Zero out gaps between media and non-overlay bar inside article/prose contexts */
.prose .photo__media-wrap,
.post-content .photo__media-wrap,
.content .photo__media-wrap { margin-bottom: 0 !important; }

.prose .photo__media-wrap + .photo__meta,
.post-content .photo__media-wrap + .photo__meta,
.content .photo__media-wrap + .photo__meta { margin-top: 0 !important; }